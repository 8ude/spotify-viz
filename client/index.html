<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Spotify Viz</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <style>
      *, *:before, *:after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <noscript>Oops! JavaScript is required to run this page.</noscript>

    <script type="x-shader/x-vertex" id="vertexshader">

			uniform float amplitude;
      uniform vec3 lightPos;
      uniform vec3 diffuseColor;
      uniform vec3 specColor;
      uniform vec3 ambientLightColor;
      uniform vec3 cameraPos;
      uniform float ambientLightIntensity;

      attribute float displacement;
			varying vec3 vNormal;
			varying vec2 vUv;
      varying vec4 forFragColor;

			void main() {
        //calculate displacement first
				vNormal = normal;
				vUv = ( 0.5 + amplitude ) * uv + vec2( amplitude );
				vec3 newPosition = position + amplitude * normal * vec3( displacement );
				gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );

        //calculate blinn-phong shading
        // all following gemetric computations are performed in the
        // camera coordinate system (aka eye coordinates)
        //vec3 normal = vec3(normalMat * vec4(inputNormal, 0.0));
        //vec4 vertPos4 = modelview * vec4(inputPosition, 1.0);
        //vec3 vertPos = vec3(vertPos4) / vertPos4.w;
        vec3 lightDir = normalize(lightPos - position);
        vec3 reflectDir = reflect(-lightDir, normal);
        vec3 viewDir = normalize(cameraPos - position);

        float lambertian = max(dot(lightDir,normal), 0.1);
        float specular = 0.0;

        if(lambertian > 0.0) {
          float specAngle = max(dot(reflectDir, viewDir), 0.0);
          specular = pow(specAngle, 2.0);

          // the exponent controls the shininess (try mode 2)
          //if(mode == 2)  specular = pow(specAngle, 16.0);

          // according to the rendering equation we would need to multiply
          // with the the "lambertian", but this has little visual effect
          //if(mode == 3) specular *= lambertian;
          // switch to mode 4 to turn off the specular component
          //if(mode == 4) specular *= 0.0;
        }

        forFragColor = vec4(lambertian*diffuseColor + specular*specColor + ambientLightIntensity*ambientLightColor, 1.0);
			}

		</script>

		<script type="x-shader/x-fragment" id="fragmentshader">
			varying vec3 vNormal;
			varying vec2 vUv;
      varying vec4 forFragColor;


			void main() {
				gl_FragColor = forFragColor;
			}
		</script>
  </body>
</html>
